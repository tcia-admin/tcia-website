<link rel="stylesheet" href="https://tcia-admin.github.io/tcia-website/main/tcia-about/css/main.css">
<section id="about-page">
    <canvas id="star-background" style="display:none;"></canvas>
    <div id="content">
        <div id="title-container">
            <h1 id="main-title"></h1>
        </div>
        <div id="who-we-are-container">
            <h2 id="who-we-are-title"></h2>
            <p id="who-we-are-statement"></p>
            <p id="who-we-are-statement-2"></p>
        </div>
        <div id="mission-container">
            <h2 id="mission-title"></h2>
            <p id="mission-statement"></p>
        </div>
        <div id="org-quote">
            <h1 id="org-quote-text"></h1>
            <h2 id="org-quote-author"></h2>
        </div>
        <div id="org-pillars">
            <!-- Pillars will be added here dynamically -->
        </div>
        <div id="team-container">
            <h2 id="team-heading"></h2>
            <div id="team-members"></div>
        </div>
    </div>

    <!-- Add this just before the closing </section> tag -->
    <div id="member-popup" class="member-popup">
        <div class="popup-content">
            <span class="close">&times;</span>
            <div class="info-column">
                <h2 class="popup-title">TCIA TEAM</h2>
                <div class="info-grid">
                    <div class="info-label">Real Name</div>
                    <div class="info-value popup-name"></div>
                    <div class="info-label">Code Name</div>
                    <div class="info-value popup-codename"></div>
                    <div class="info-label">Role</div>
                    <div class="info-value popup-role"></div>
                    <div class="info-label">Specialty</div>
                    <div class="info-value popup-specialty"></div>
                </div>
                <div class="popup-bio-container">
                    <div class="popup-bio"></div>
                </div>
            </div>
            <div class="image-column">
                <img src="" alt="Team Member" class="popup-image">
            </div>
        </div>
    </div>
</section>

<script>
    // Improved error handler that handles null errors better
    window.addEventListener('error', function(e) {
        console.error('Global error handler:', e.error || e.message || 'Unknown error', e);
    });
    
    // Throttle the star background animation
    let lastFrame = 0;
    const FRAME_LIMIT = 1000 / 30; // 30 FPS limit
    
    function throttleAnimation(timestamp) {
        if (timestamp - lastFrame < FRAME_LIMIT) return;
        lastFrame = timestamp;
        // Original animation code here
    }
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
<!-- Add defer and async to prevent blocking -->
<script src="https://tcia-admin.github.io/tcia-website/main/tcia-about/js/tcia-about-new.js" defer async></script>

<script>
    
    document.addEventListener('DOMContentLoaded', () => {
        const images = document.querySelectorAll('.member-image, .popup-image');
        
        if ('loading' in HTMLImageElement.prototype) {
            // Browser supports native lazy loading
            images.forEach(img => {
                img.loading = 'lazy';
                img.decoding = 'async'; // Add async decoding for better performance
            });
        } else {
            // Fallback for browsers that don't support lazy loading
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js';
            script.onload = () => {
                const observer = lozad(images);
                observer.observe();
            };
            document.body.appendChild(script);
        }
    });
</script>

<script>
    // Add this before loading the external JS
    let retryCount = 0;
    const maxRetries = 3;

    function checkAndInitializeTeamMembers() {
        const teamContainer = document.getElementById('team-members');
        if (!teamContainer) return;

        // If container is empty and we haven't exceeded max retries
        if (!teamContainer.children.length && retryCount < maxRetries) {
            retryCount++;
            console.log(`Attempt ${retryCount} to initialize team members`);

            // Remove and re-add the script to force a reload
            const oldScript = document.querySelector('script[src*="tcia-about-new.js"]');
            if (oldScript) {
                oldScript.remove();
                
                const newScript = document.createElement('script');
                newScript.src = 'https://tcia-admin.github.io/tcia-server-files/tcia-about-new.js';
                newScript.onload = () => {
                    console.log('Script reloaded successfully');
                };
                newScript.onerror = () => {
                    console.error('Script reload failed');
                };
                document.body.appendChild(newScript);
            }
        }
    }

    // Check immediately after DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
        // Initial check
        checkAndInitializeTeamMembers();

        // Set up additional checks
        setTimeout(checkAndInitializeTeamMembers, 1000);
        setTimeout(checkAndInitializeTeamMembers, 2000);
    });

    // Also check when the window loads completely
    window.addEventListener('load', checkAndInitializeTeamMembers);
</script>

<!-- Modify the script tag to add an ID and error handling -->
<script 
    src="https://tcia-admin.github.io/tcia-server-files/tcia-about-new.js" 
    onerror="checkAndInitializeTeamMembers()"
    id="tcia-main-script">
</script>

<script>
    // Add this after your existing scripts to handle ResizeObserver errors
    (function() {
        // Detect and suppress ResizeObserver loop limit errors
        const consoleError = window.console.error;
        window.console.error = function(message) {
            if (message && typeof message === 'string' && 
                message.indexOf('ResizeObserver loop') !== -1) {
                // Ignore ResizeObserver loop errors
                return;
            }
            consoleError.apply(this, arguments);
        };
        
        // Create a debounced resize handler for any ResizeObserver usage
        window.createDebouncedResizeObserver = function(callback, delay = 100) {
            let timeoutId;
            
            const observer = new ResizeObserver(entries => {
                // Clear any existing timeout
                clearTimeout(timeoutId);
                
                // Set a new timeout to run the callback
                timeoutId = setTimeout(() => {
                    callback(entries);
                }, delay);
            });
            
            return observer;
        };
    })();
</script>